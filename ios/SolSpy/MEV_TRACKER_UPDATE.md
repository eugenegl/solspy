# MEV Tracker - Обновления

## Основные изменения

### 1. Интеграция с реальным API 
- **Эндпоинт**: `https://api.solspy.io/api/v1/sandwiches?days=30`
- **Новые модели данных**: `SandwichesResponse`, `SandwichStats`, `SandwichEvent`
- **API сервис**: `MEVAPIService` для работы с данными

### 2. Удален realtime индикатор
- Убран постоянно мигающий индикатор "realtime"
- Добавлен индикатор "pull to refresh" в неактивном состоянии
- Показывает "updating..." во время загрузки данных

### 3. Pull-to-refresh функциональность
- Реализован асинхронный pull-to-refresh на всем экране
- Автоматическое обновление данных по свайпу вниз
- Индикация процесса загрузки

### 4. Обновленная статистика
**Старые метрики:**
- Extracted
- Sandwiches
- Cost (убрана)
- Victims  
- Attackers

**Новые метрики из API:**
- **SOL Drained** - общая сумма украденного SOL (красный цвет)
- **Sandwich Attacks** - количество атак (оранжевый)
- **Victims** - количество жертв (желтый) 
- **Attackers** - количество атакующих (фиолетовый)

### 5. Новый дизайн событий
- **SandwichEventCard** - новый компонент для отображения реальных атак
- Показывает детали: атакующий, жертва, сумма, токен, источник
- Цветовая индикация источника (pump, pumpswap, raydium)
- Кнопка копирования хеша транзакции

### 6. Фильтр времени
**Новые периоды:**
- last 1D (1 день)
- last 3D (3 дня) 
- last 7D (7 дней)
- last 30D (30 дней)

### 7. Обработка ошибок
- ErrorBanner для отображения ошибок API
- Кнопка "Retry" для повторной попытки
- Индикация состояний загрузки

## Новые файлы

1. **MEVAPIService.swift** - сервис для работы с API
2. **SandwichEventCard.swift** - компонент карточки атаки
3. **SandwichStreamView.swift** - компонент списка атак

## Обновленные файлы

1. **MEVModels.swift** - добавлены новые модели данных
2. **MEVTrackerViewModel.swift** - интеграция с API, убран realtime
3. **MEVTracker.swift** - обновлен UI, добавлен pull-to-refresh
4. **MEVStreamView.swift** - обновлены индикаторы
5. **MEVStatsCard.swift** - новые метрики и цвета

## Особенности реализации

### Совместимость
- Сохранена обратная совместимость через legacy модели
- Старые компоненты работают с новыми данными через адаптеры

### Async/Await
- Все API запросы используют современный async/await
- Правильная обработка ошибок и индикация загрузки

### Pull-to-Refresh
- Нативная реализация через `.refreshable`
- Автоматическая индикация процесса обновления

### Дизайн
- Цветовая схема отражает характер данных (красный для украденных средств)
- Адаптивная верстка под разные размеры экранов
- Анимации переходов между состояниями

## Использование

1. **Обновление данных**: потяните экран вниз
2. **Смена периода**: нажмите на фильтр времени в правом верхнем углу
3. **Копирование транзакции**: нажмите "Copy TX" в карточке события
4. **Повтор при ошибке**: нажмите "Retry" в баннере ошибки

## API Структура

```json
{
  "stats": {
    "solDrained": 413.438620294,
    "sandwichesCount": 3366,
    "victimsCount": 2525,
    "attackersCount": 159
  },
  "sandwiches": [
    {
      "tokenAddress": "...",
      "walletAddress": "...",
      "solDrained": 0.082763832,
      "txHashBuy": "...",
      "txHashSell": "...",
      "victimWalletAddress": "...",
      "victimAmountIn": 4.241447682,
      "victimTxHash": "...",
      "slot": 347107431,
      "source": "pump",
      "createdAt": "2025-06-16T05:29:23.000Z"
    }
  ]
}
``` 